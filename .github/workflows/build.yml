name: Build

on:
  push:
    branches: [ dev ]
  pull_request:
    branches: [ dev ]

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup .NET Framework
      uses: microsoft/setup-msbuild@v2

    - name: Setup NuGet
      uses: nuget/setup-nuget@v2

    - name: Restore NuGet packages
      run: nuget restore LuckierBlackCat.sln

    - name: Build solution (Debug)
      run: msbuild LuckierBlackCat.sln /p:Configuration=Debug /p:Platform="Any CPU"

    - name: Build solution (Release)
      run: msbuild LuckierBlackCat.sln /p:Configuration=Release /p:Platform="Any CPU"

    - name: Upload Debug Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: LuckierBlackCat-Debug-${{ github.sha }}
        path: |
          bin/Debug/LuckierBlackCat.dll
          bin/Debug/package.xml
          bin/Debug/preview.jpg
          bin/Debug/*.md
        retention-days: 30

    - name: Upload Release Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: LuckierBlackCat-Release-${{ github.sha }}
        path: |
          bin/Release/LuckierBlackCat.dll
          bin/Release/package.xml
          bin/Release/preview.jpg
          bin/Release/*.md
        retention-days: 30

    - name: Check for code issues
      run: |
        echo "Checking for common code issues..."
        # 检查是否有硬编码的路径（避免在CI中出现问题）
        if (Select-String -Path "*.cs" -Pattern "D:\\Program Files" -Quiet) {
          Write-Warning "Found hardcoded paths in source code"
        }
        echo "Code check completed"
